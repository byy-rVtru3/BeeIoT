# Подтверждение кода

## Описание
Универсальный эндпоинт для подтверждения кодов, отправленных на почту. Используется для:
- Подтверждения регистрации пользователя
- Подтверждения кода при сбросе пароля

## HTTP запрос
```
POST /api/auth/confirm
```

## Тело запроса
```json
{
  "email": "user@example.com",
  "code": "123456",
  "type": "registration"
}
```

### Параметры
- `email` (string, обязательный) - Email адрес пользователя
- `code` (string, обязательный) - Код подтверждения, отправленный на почту
- `type` (string, обязательный) - Тип подтверждения: `"registration"` или `"password_reset"`

## Ответы

### 200 OK

#### Для регистрации (type: "registration")
Аккаунт успешно подтвержден.
```json
{
  "code": 200,
  "message": "Аккаунт успешно подтвержден"
}
```

#### Для сброса пароля (type: "password_reset")
Код подтвержден, можно устанавливать новый пароль.
```json
{
  "code": 200,
  "message": "Код подтвержден. Можете установить новый пароль"
}
```

### 401 Unauthorized
Неверный код подтверждения или истек срок действия.
```json
{
  "code": 401,
  "message": "Неверный или истекший код подтверждения"
}
```

### 404 Not Found
Пользователь не найден.
```json
{
  "code": 404,
  "message": "Пользователь не найден"
}
```

### 410 Gone
Код уже использован или больше не действителен.
```json
{
  "code": 410,
  "message": "Код уже использован или больше не действителен"
}
```

### 429 Too Many Requests
Слишком много попыток подтверждения.
```json
{
  "code": 429,
  "message": "Слишком много попыток. Попробуйте позже",
  "retry_after": 300
}
```

### 500 Internal Server Error
Внутренняя ошибка сервера.
```json
{
  "code": 500,
  "message": "Внутренняя ошибка сервера"
}
```

## Дополнительная информация

### Повторная отправка кода
Если код не пришел или истек, можно запросить новый:
- Для регистрации: `POST /api/auth/resend-confirmation`
- Для сброса пароля: `POST /api/auth/password-reset/request`

### Время жизни кода
- Код подтверждения действителен в течение 15 минут
- Максимум 3 попытки ввода неверного кода
- После исчерпания попыток требуется запрос нового кода

### Примеры запросов

#### Подтверждение регистрации
```json
{
  "email": "user@example.com",
  "code": "123456",
  "type": "registration"
}
```

#### Подтверждение сброса пароля
```json
{
  "email": "user@example.com",
  "code": "987654",
  "type": "password_reset"
}
```

## Связанные эндпоинты
- [Регистрация](./registration.md) - создание аккаунта
- [Авторизация](./login.md) - вход в систему
- [Сброс пароля](./reset.md) - восстановление доступа